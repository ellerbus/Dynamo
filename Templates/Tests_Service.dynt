{% include 'NamingConventions' -%}
{% capture PROJECT %}{{ SOLUTION }}.Tests{% endcapture -%}
{% capture FILENAME %}{{ PROJECT }}\Core\Services\{{ BASECLASS }}ServiceTests.cs{% endcapture -%}
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using AutoMoq;
using FluentValidation;
using FluentValidation.Results;
using FizzWare.NBuilder;
using Moq;
using {{ SOLUTION }}.Core.Models;
using {{ SOLUTION }}.Core.Repositories;
using {{ SOLUTION }}.Core.Services;

namespace {{ PROJECT }}.Core.Services
{
	[TestClass]
	public class {{ BASECLASS }}ServiceTests
	{
		#region Helpers/Test Initializers

		private AutoMoqer Mocker { get; set; }
		private Mock<{{ IREPOSITORY }}> MockRepo { get; set; }
		private Mock<{{ IVALIDATOR }}> MockValidator { get; set; }
		private {{ SERVICE }} SubjectUnderTest { get; set; }

		[TestInitialize]
		public void TestInitialize()
		{
			Mocker = new AutoMoqer();

			SubjectUnderTest = Mocker.Create<{{ SERVICE }}>();
			
			MockRepo = Mocker.GetMock<{{ IREPOSITORY }}>();

			MockValidator = Mocker.GetMock<{{ IVALIDATOR }}>();
		}

		#endregion

		#region Tests - Get
		
		[TestMethod]
		public void {{ SERVICE }}_GetMany_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 
		
			MockRepo.Setup(x => x.GetList()).Returns({{ CAMELCLASSES }});

			//	act
			var actual = SubjectUnderTest.GetList();

			//	assert
			Assert.AreSame({{ CAMELCLASSES }}, actual);

			MockRepo.VerifyAll();
		}

		[TestMethod]
		public void {{ SERVICE }}_GetOne_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();
			
			MockRepo.Setup(x => x.Get({% for column in table.primary_keys %}{{ CAMELCLASS }}.{{ column.property_name }}{%if forloop.last == false %}, {% endif %}{% endfor %})).Returns({{ CAMELCLASS }});

			//	act
			var actual = SubjectUnderTest.Get({% for column in table.primary_keys %}{{ CAMELCLASS }}.{{ column.property_name }}{%if forloop.last == false %}, {% endif %}{% endfor %});

			//	assert
			Assert.IsNotNull(actual);			
			{% for column in table.columns %}
			Assert.AreEqual({{ CAMELCLASS }}.{{ column.property_name }}, actual.{{ column.property_name }});{% endfor %}

			MockRepo.VerifyAll();
		}
		
		#endregion
		
		#region Tests - Save

		[TestMethod]
		public void {{ SERVICE }}_Save_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();
			
			MockRepo.Setup(x => x.Save({{ CAMELCLASS }}));

			MockValidator.Setup(x => x.Validate({{ CAMELCLASS }})).Returns(new ValidationResult());

			//	act
			SubjectUnderTest.Save({{ CAMELCLASS }});

			//	assert

			MockRepo.VerifyAll();
			MockValidator.VerifyAll();
		}

		[TestMethod, ExpectedException(typeof(ValidationException))]
		public void {{ SERVICE }}_Save_Should_ThrowException()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();

			MockRepo.Setup(x => x.Insert({{ CAMELCLASS }}));

			MockValidator.Setup(x => x.Validate({{ CAMELCLASS }})).Returns(new ValidationResult(new[] { new ValidationFailure("", "") }));

			//	act
			SubjectUnderTest.Save({{ CAMELCLASS }});
		}

		[TestMethod]
		public void {{ SERVICE }}_SaveMany_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 
			
			MockRepo.Setup(x => x.Save({{ CAMELCLASSES }}));

			MockValidator.Setup(x => x.Validate(It.IsAny<{{ BASECLASS }}>())).Returns(new ValidationResult());

			//	act
			SubjectUnderTest.Save({{ CAMELCLASSES }});

			//	assert

			MockRepo.VerifyAll();
			MockValidator.VerifyAll();
		}

		[TestMethod, ExpectedException(typeof(ValidationException))]
		public void {{ SERVICE }}_SaveMany_Should_ThrowException()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 

			MockRepo.Setup(x => x.Save({{ CAMELCLASSES }}));

			MockValidator.Setup(x => x.Validate(It.IsAny<{{ BASECLASS }}>())).Returns(new ValidationResult(new[] { new ValidationFailure("", "") }));

			//	act
			SubjectUnderTest.Save({{ CAMELCLASSES }});
		}
		
		#endregion
		
		#region Tests - Insert

		[TestMethod]
		public void {{ SERVICE }}_Insert_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();
			
			MockRepo.Setup(x => x.Insert({{ CAMELCLASS }}));

			MockValidator.Setup(x => x.Validate({{ CAMELCLASS }})).Returns(new ValidationResult());

			//	act
			SubjectUnderTest.Insert({{ CAMELCLASS }});

			//	assert

			MockRepo.VerifyAll();
			MockValidator.VerifyAll();
		}

		[TestMethod, ExpectedException(typeof(ValidationException))]
		public void {{ SERVICE }}_Insert_Should_ThrowException()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();

			MockRepo.Setup(x => x.Insert({{ CAMELCLASS }}));

			MockValidator.Setup(x => x.Validate({{ CAMELCLASS }})).Returns(new ValidationResult(new[] { new ValidationFailure("", "") }));

			//	act
			SubjectUnderTest.Insert({{ CAMELCLASS }});
		}

		[TestMethod]
		public void {{ SERVICE }}_InsertMany_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 
			
			MockRepo.Setup(x => x.Insert({{ CAMELCLASSES }}));

			MockValidator.Setup(x => x.Validate(It.IsAny<{{ BASECLASS }}>())).Returns(new ValidationResult());

			//	act
			SubjectUnderTest.Insert({{ CAMELCLASSES }});

			//	assert

			MockRepo.VerifyAll();
			MockValidator.VerifyAll();
		}

		[TestMethod, ExpectedException(typeof(ValidationException))]
		public void {{ SERVICE }}_InsertMany_Should_ThrowException()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 

			MockRepo.Setup(x => x.Insert({{ CAMELCLASSES }}));

			MockValidator.Setup(x => x.Validate(It.IsAny<{{ BASECLASS }}>())).Returns(new ValidationResult(new[] { new ValidationFailure("", "") }));

			//	act
			SubjectUnderTest.Insert({{ CAMELCLASSES }});
		}
		
		#endregion
		
		#region Tests - Update

		[TestMethod]
		public void {{ SERVICE }}_Update_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();
			
			MockRepo.Setup(x => x.Update({{ CAMELCLASS }}));

			MockValidator.Setup(x => x.Validate({{ CAMELCLASS }})).Returns(new ValidationResult());

			//	act
			SubjectUnderTest.Update({{ CAMELCLASS }});

			//	assert

			MockRepo.VerifyAll();
			MockValidator.VerifyAll();
		}

		[TestMethod, ExpectedException(typeof(ValidationException))]
		public void {{ SERVICE }}_Update_Should_ThrowException()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();

			MockRepo.Setup(x => x.Update({{ CAMELCLASS }}));

			MockValidator.Setup(x => x.Validate({{ CAMELCLASS }})).Returns(new ValidationResult(new[] { new ValidationFailure("", "") }));

			//	act
			SubjectUnderTest.Update({{ CAMELCLASS }});
		}

		[TestMethod]
		public void {{ SERVICE }}_UpdateMany_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 
			
			MockRepo.Setup(x => x.Update({{ CAMELCLASSES }}));

			MockValidator.Setup(x => x.Validate(It.IsAny<{{ BASECLASS }}>())).Returns(new ValidationResult());

			//	act
			SubjectUnderTest.Update({{ CAMELCLASSES }});

			//	assert

			MockRepo.VerifyAll();
			MockValidator.VerifyAll();
		}

		[TestMethod, ExpectedException(typeof(ValidationException))]
		public void {{ SERVICE }}_UpdateMany_Should_ThrowException()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 

			MockRepo.Setup(x => x.Update({{ CAMELCLASSES }}));

			MockValidator.Setup(x => x.Validate(It.IsAny<{{ BASECLASS }}>())).Returns(new ValidationResult(new[] { new ValidationFailure("", "") }));

			//	act
			SubjectUnderTest.Update({{ CAMELCLASSES }});
		}
		
		#endregion
		
		#region Tests - Delete

		[TestMethod]
		public void {{ SERVICE }}_Delete_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASS }} = Builder<{{ BASECLASS }}>.CreateNew().Build();
			
			MockRepo.Setup(x => x.Delete({{ CAMELCLASS }}));

			//	act
			SubjectUnderTest.Delete({{ CAMELCLASS }});

			//	assert

			MockRepo.VerifyAll();
		}

		[TestMethod]
		public void {{ SERVICE }}_DeleteMany_Should_Succeed()
		{
			//	arrange
			var {{ CAMELCLASSES }} = Builder<{{ BASECLASS }}>.CreateListOfSize(10).Build(); 
			
			MockRepo.Setup(x => x.Delete({{ CAMELCLASSES }}));

			//	act
			SubjectUnderTest.Delete({{ CAMELCLASSES }});

			//	assert

			MockRepo.VerifyAll();
		}

		#endregion
	}
}